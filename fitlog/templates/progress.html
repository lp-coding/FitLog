{% extends "base.html" %}
{% block title %}Fortschritt – FitLog{% endblock %}

{% block content %}
<h2>Fortschritt</h2>

<form method="get" action="{{ url_for('progress.progress_home') }}" class="form-grid">
  <!-- Diagrammtyp -->
  <label for="diagram_type">Diagramm</label>
  <select id="diagram_type" name="type" onchange="this.form.submit()">
    <option value="exercise" {{ 'selected' if diagram_type=='exercise' else '' }}>Leistung über Zeit</option>
    <option value="plan"     {{ 'selected' if diagram_type=='plan' else '' }}>Leistungsstand pro Trainingsplan</option>
  </select>

  <!-- Close / Zurück rechts oben -->
  <a class="btn btn-ghost" href="{{ url_for('index') }}" style="justify-self:end">X</a>

  <!-- Dynamische zweite Auswahl -->
  {% if diagram_type == 'exercise' %}
    <label for="exercise_id">Übung</label>
    <select id="exercise_id" name="exercise_id" onchange="this.form.submit()">
      {% for eid, ename in exercises %}
        <option value="{{ eid }}" {{ 'selected' if eid==selected_exercise else '' }}>{{ ename }}</option>
      {% endfor %}
    </select>
    <div></div>
    <a class="btn" href="{{ url_for('progress.exercise_chart_png', exercise_id=selected_exercise, download=1) }}">Export</a>

    <div class="chart-frame">
      <img
        alt="Zeitverlauf"
        src="{{ url_for('progress.exercise_chart_png', exercise_id=selected_exercise) }}"
        class="chart-img" />
    </div>

  {% elif diagram_type == 'plan' %}
    <label for="plan_id">Trainingsplan</label>
    <select id="plan_id" name="plan_id" onchange="this.form.submit()">
      {% for pid, pname in plans %}
        <option value="{{ pid }}" {{ 'selected' if pid==selected_plan else '' }}>{{ pname }}</option>
      {% endfor %}
    </select>
    <div></div>
    <a class="btn" href="{{ url_for('progress.plan_chart_png', plan_id=selected_plan, download=1) }}">Export</a>

    <div class="chart-frame">
      <img
        alt="Plan-Übersicht"
        src="{{ url_for('progress.plan_chart_png', plan_id=selected_plan) }}"
        class="chart-img" />
    </div>
  {% endif %}

  <div></div>
  <a class="btn" href="{{ url_for('index') }}">Zurück</a>
</form>

<style>
  /* dezente, neutrale Styles – fügt sich in deine CSS ein */
  .form-grid {
    display: grid;
    grid-template-columns: 10rem 20rem 1fr auto;
    gap: .75rem 1rem;
    align-items: center;
    margin-top: .5rem;
  }
  .btn { padding: .4rem .8rem; border: 1px solid #999; background: #eee; text-decoration: none; }
  .btn-ghost { padding: .25rem .5rem; border: 1px solid #999; background: transparent; text-decoration: none; }
  .chart-frame { grid-column: 1 / -1; margin-top: .5rem; }
  .chart-img { width: 100%; max-width: 900px; height: auto; display: block; border: 1px solid #aac; background: #eef; }
  @media (max-width: 700px) {
    .form-grid { grid-template-columns: 1fr 1fr; }
    .chart-img { max-width: 100%; }
  }
</style>
{% endblock %}
