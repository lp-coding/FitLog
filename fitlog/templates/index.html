{% extends "base.html" %}
{% block title %}FitLog – Start{% endblock %}

{% block content %}
<h1 class="logo">FitLog</h1>

<div class="dashboard">
  <!-- Linkes Card: Trainingspläne -->
  <section class="card">
    <h2>Trainingspläne</h2>

    <!-- Anlegen -->
    <div class="add-row">
      <input id="newPlanName" class="input" type="text" placeholder="Neuer Planname">
      <form id="createForm" action="{{ url_for('plans.create_plan') }}" method="post" style="display:inline;">
        <input type="hidden" name="name" id="newPlanNameHidden">
        <button id="btnAdd" class="btn" type="submit">Hinzufügen</button>
      </form>
    </div>

    <!-- Liste -->
    <select id="planSelect" class="list" size="10">
      {% for p in plans %}
        <option value="{{ p.id }}">{{ p.name }}</option>
      {% else %}
        <option disabled>(Noch keine Trainingspläne vorhanden)</option>
      {% endfor %}
    </select>

    <!-- Aktionen -->
    <div class="actions">
      <button id="btnDelete" class="btn" type="button">Löschen</button>
      <button id="btnEdit"   class="btn" type="button">Bearbeiten</button>
      <a class="btn" href="{{ url_for('plans.list_plans_page') }}">Alle anzeigen</a>
    </div>
  </section>

  <!-- Rechtes Card: Verlauf (Platzhalter) -->
  <section class="card">
    <h2>Verlauf</h2>
    <div class="stack">
      <button class="btn" type="button">Verbrauchte Kalorien</button>
      <button class="btn" type="button">Trainingsfortschritt</button>
    </div>

    <h3>Letztes Training</h3>
    <p class="muted">Noch keine Trainingseinheit erfasst.</p>
  </section>
</div>

<div class="centered">
  <button class="btn btn--primary" type="button">Trainingsdaten erfassen</button>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const inputNew   = document.getElementById('newPlanName');
  const inputHide  = document.getElementById('newPlanNameHidden');
  const createForm = document.getElementById('createForm');

  const select     = document.getElementById('planSelect');
  const btnEdit    = document.getElementById('btnEdit');
  const btnDelete  = document.getElementById('btnDelete');

  // Name in Hidden spiegeln (damit /plans/create ihn bekommt)
  if (createForm) {
    createForm.addEventListener('submit', () => {
      inputHide.value = (inputNew.value || '').trim();
    });
  }

  const getSelectedId = () => (select && select.value ? select.value : null);

  // Bearbeiten -> /plans/<id>/edit
  if (btnEdit) {
    btnEdit.addEventListener('click', () => {
      const id = getSelectedId();
      if (!id) { alert('Bitte einen Plan auswählen.'); return; }
      window.location.href = `/plans/${id}/edit`;
    });
  }

  // Löschen (Soft-Delete) -> POST /plans/<id>/delete
  if (btnDelete) {
    btnDelete.addEventListener('click', async () => {
      const id = getSelectedId();
      if (!id) { alert('Bitte einen Plan auswählen.'); return; }
      if (!confirm('Diesen Plan wirklich archivieren (Soft-Delete)?')) return;
      try {
        const res = await fetch(`/plans/${id}/delete`, { method: 'POST' });
        if (res.ok) window.location.reload();
        else alert('Löschen fehlgeschlagen.');
      } catch {
        alert('Netzwerkfehler beim Löschen.');
      }
    });
  }
});
</script>

<style>
  .logo { font-size: 2rem; font-weight: 800; margin: .5rem 0 1rem; }
  .dashboard { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
  .card { background: #fff; border-radius: 12px; padding: 1rem; box-shadow: 0 1px 4px rgba(0,0,0,.06); }
  .add-row { display: flex; gap: .5rem; margin-bottom: .5rem; }
  .input { flex: 1; padding: .55rem .7rem; border: 1px solid #ddd; border-radius: 8px; }
  .list { width: 100%; min-height: 200px; border: 1px solid #eee; border-radius: 8px; padding: .5rem; }
  .actions { display: flex; gap: .5rem; margin-top: .6rem; }
  .stack { display: flex; flex-direction: column; gap: .5rem; margin-bottom: 1rem; }
  .btn { background: #f4f4f7; border: 1px solid #e2e3e6; border-radius: 8px; padding: .45rem .8rem; cursor: pointer; }
  .btn:hover { background: #e9eaf0; }
  .btn--primary { background: #1f60ff; color: #fff; border: none; padding: .75rem 1.2rem; }
  .btn--primary:hover { background: #154fe0; }
  .centered { text-align: center; margin-top: 1.6rem; }
  .muted { color: #79808a; }
  @media (max-width: 900px){ .dashboard { grid-template-columns: 1fr; } }
</style>
{% endblock %}
